<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Data&nbsp;Encryption&nbsp;at&nbsp;rest | @vishnuatrai]]></title>
  <link href="http://vishnuatrai.in/blog/categories/data-encryption-at-rest/atom.xml" rel="self"/>
  <link href="http://vishnuatrai.in/"/>
  <updated>2021-01-03T18:45:42+05:30</updated>
  <id>http://vishnuatrai.in/</id>
  <author>
    <name><![CDATA[vishnuatrai.in]]></name>
    <email><![CDATA[vishnu.atrai@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[MySQL - Encryption at Rest]]></title>
    <link href="http://vishnuatrai.in/blog/2020/01/11/mysql-encryption-at-rest/"/>
    <updated>2020-01-11T18:20:46+05:30</updated>
    <id>http://vishnuatrai.in/blog/2020/01/11/mysql-encryption-at-rest</id>
    <content type="html"><![CDATA[<p>Without encryption of data at rest, system role with access to file system can view data even without proper database permissions. A proper authentication can be used to protect data used by an application but data sitting in file system has been area of risk.</p>

<p>With encryption at rest, it has been possible to protect data in transit when moving over the network. Data at Rest Encryption is a requirement for HIPAA, PCI regulations. <!--more--></p>

<h3>Data Files at Risk</h3>

<p>When insert queries run to store data in tables, the data will be stored in respective <code>dataDir</code> ie <code>/usr/local/var/mysql</code>. A system user that has filesystem access can use <code>strings</code> or <code>xxd</code> commands to view content in data files, bin logs or redo logs.</p>

<p>One way to avoid this risk either not to store sensitive data in database or encrypt sensitive data columns or encrypt the file system itself.</p>

<p>Other way is to implement Data encryption at rest.</p>

<h3>Implement Data Encryption at rest, MySQL</h3>

<p>First step to create a key using <code>openssl</code> command</p>

<pre><code>openssl enc -aes-256-cbc -md sha1 -k &lt;enc password or passphase&gt; -in keys.txt -out mysql.enc
</code></pre>

<p>Second, edit <code>/etc/my.cnf</code> and provide encryption configurations</p>

<pre><code>plugin-load-add=file_key_management.so
file-key-management-filename=/var/lib/mysql/keys.txt
innodb-encrypt-tables
innodb-encrypt-log
encrypt-binlog
</code></pre>

<p><code>plugin-load-add</code> option will load the encryption plugin on mysql start.<br/>
<code>file-key-management-filename</code> option to provide reference to encryption key file.<br/>
<code>innodb-encrypt-tables</code> option will encrypt tables by default.<br/>
<code>innodb-encrypt-log</code> option will encrypt redo logs by default.<br/>
<code>encrypt-binlog</code> option will encrypt binlogs.</p>

<p>Third, restart mysql</p>

<pre><code>service mysql restart
</code></pre>

<p>Fourth, enable the same options on the replication slaves</p>

<p>Fifth, verify tables are encrypted using below mysql query</p>

<pre><code>select * from information_schema.INNODB_TABLESPACES_ENCRYPTION where ENCRYPTION_SCHEME=1;
</code></pre>

<br/>


<h3>innodb-encrypt-tables modes</h3>

<p>Three ways to encrypt tables<br/></p>

<ol>
<li><code>innodb-encrypt-tables</code> option in <code>my.cnf</code> will encrypt all tables unless table creation statement provided &ldquo;encrypted=no&rdquo; <br/></li>
<li><code>innodb-encrypt-tables</code> option in <code>my.cnf</code> will encrypt all tables and will not allow table creation with &ldquo;encrypted=no&rdquo; <br/></li>
<li><code>innodb-encrypt-tables</code> option is not provided in <code>my.cnf</code> but the plugin presents, it can explicitely encrypt a table by including &ldquo;encrypted=yes&rdquo; in table creation statement.<br/></li>
</ol>


<h3>Performance Overhead</h3>

<p>~5% to ~10% performance overhead observed in previous MySQL deployments with database enforced encryption mode.</p>

<p>Database-level encryption and selective tables encryption can be a better option than the filesystem-level encryption.</p>
]]></content>
  </entry>
  
</feed>
